<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <!-- Based on Powershell installer (MIT license): https://github.com/PowerShell/PowerShell/commit/795c61125a531d62784e299a3159844b733e8a91 -->
  <Fragment>
    <CustomAction Id="SaveShortcutPath" Property="ShortcutPath" Value="[$ApplicationProgramsMenuShortcut]$(var.ProductSemanticVersionWithNameAndOptionalArchitecture).lnk" />
    <CustomAction Id="FixShortcutWorkingDirectory" Script="vbscript" HideTarget="no" Impersonate="no">
      shortcutPath = Session.Property("ShortcutPath")
      Set fso = CreateObject("Scripting.FileSystemObject")
      if (fso.FileExists(shortcutPath)) Then
        Set wshShell = CreateObject("WSCript.Shell")
        Set shortcut = wshShell.CreateShortcut(shortcutPath)

        shortcut.workingdirectory = "%HOMEDRIVE%%HOMEPATH%"
        shortcut.save
      End If
    </CustomAction>
    <InstallExecuteSequence>
      <Custom Action="SaveShortcutPath" After="InstallFinalize" />
      <Custom Action="FixShortcutWorkingDirectory" After="SaveShortcutPath">
        NOT Installed OR NOT REMOVE OR UPGRADINGPRODUCTCODE
      </Custom>
    </InstallExecuteSequence>
  </Fragment>
</Wix>
